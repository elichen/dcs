#!/usr/bin/env python3
"""
fetch-target - Get current target position

Usage:
    fetch-target <session-id>
    
Output:
    JSON with target position
"""

import sys
import os
import json

# Add parent directory to Python path
sys.path.insert(0, os.path.join(os.path.dirname(os.path.abspath(__file__)), '..'))

from lib.fetch_api import FetchAPI

def main():
    if len(sys.argv) != 2:
        print("Usage: fetch-target <session-id>", file=sys.stderr)
        return 1
    
    session_id = sys.argv[1]
    
    # Get target position using Direct API
    try:
        api = FetchAPI.connect(session_id)
        target_pos = api.get_target_position()
        
        result = {
            "success": True,
            "position": target_pos,
            "x": target_pos[0],
            "y": target_pos[1], 
            "z": target_pos[2]
        }
    except Exception as e:
        result = {"success": False, "message": f"Direct API failed: {str(e)}"}
    
    print(json.dumps(result))
    return 0

if __name__ == '__main__':
    sys.exit(main())