#!/usr/bin/env python3
"""
fetch-grip - Control Fetch robot gripper

Usage:
    fetch-grip <session-id> open
    fetch-grip <session-id> close
    
Output:
    JSON with success status and message
"""

import sys
import os
import json

# Add parent directory to Python path
sys.path.insert(0, os.path.join(os.path.dirname(os.path.abspath(__file__)), '..'))

from lib.fetch_session import SessionManager

def main():
    if len(sys.argv) != 3:
        print("Usage: fetch-grip <session-id> <open|close>", file=sys.stderr)
        return 1
    
    session_id = sys.argv[1]
    action = sys.argv[2].lower()
    
    if action not in ['open', 'close']:
        result = {"success": False, "message": "Action must be 'open' or 'close'"}
        print(json.dumps(result))
        return 1
    
    # Check if session exists
    state = SessionManager.get_session_state(session_id)
    if not state:
        result = {"success": False, "message": f"Session {session_id} not found"}
        print(json.dumps(result))
        return 1
    
    # Send gripper command
    command = {
        "action": "gripper",
        "open": action == 'open'
    }
    
    success, message = SessionManager.send_command(session_id, command)
    
    result = {
        "success": success,
        "message": message,
        "gripper_action": action
    }
    
    print(json.dumps(result))
    return 0 if success else 1

if __name__ == '__main__':
    sys.exit(main())